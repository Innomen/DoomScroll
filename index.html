<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Doom That Wasn't</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=IBM+Plex+Mono:wght@400;500&family=Source+Serif+4:opsz,wght@8..60,300;8..60,400&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d0d0b;
      --surface: #131210;
      --border: #1e1a16;
      --border-mid: #2a2520;
      --gold: #c9a84c;
      --gold-dim: rgba(201, 168, 76, 0.12);
      --text-bright: #f0e8d0;
      --text-mid: #c8bfaa;
      --text-dim: #6b6050;
      --text-faint: #3d3528;
      --green: #8aaa6a;
      --green-bg: rgba(100, 160, 80, 0.06);
      --green-border: #4a7a30;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text-mid);
      font-family: 'Source Serif 4', Georgia, serif;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    /* â”€â”€ Layout â”€â”€ */
    .app {
      max-width: 720px;
      margin: 0 auto;
      padding: 0 20px 100px;
    }

    /* â”€â”€ Masthead â”€â”€ */
    .masthead {
      text-align: center;
      padding: 52px 0 28px;
      border-bottom: 3px double var(--gold);
      margin-bottom: 0;
    }

    .masthead-eyebrow {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      letter-spacing: 5px;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 16px;
      opacity: 0.8;
    }

    .masthead-title {
      font-family: 'Playfair Display', serif;
      font-size: clamp(36px, 9vw, 72px);
      font-weight: 900;
      line-height: 0.88;
      color: var(--text-bright);
    }

    .masthead-title em {
      font-style: italic;
      color: var(--gold);
    }

    .masthead-rule {
      width: 40px;
      height: 1px;
      background: var(--gold);
      margin: 18px auto;
      opacity: 0.4;
    }

    .masthead-sub {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      color: var(--text-dim);
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    /* â”€â”€ Date line â”€â”€ */
    .dateline {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0 18px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 20px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-faint);
    }

    .dateline-count {
      color: var(--text-dim);
    }

    /* â”€â”€ Algo bar â”€â”€ */
    .algo-section {
      margin-bottom: 28px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    .algo-label {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 3px;
      color: var(--text-faint);
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .algo-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .algo-tag {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 1px;
      text-transform: uppercase;
      padding: 4px 10px;
      border: 1px solid var(--border-mid);
      border-radius: 2px;
      color: var(--text-faint);
      transition: all 0.3s;
      cursor: default;
    }

    .algo-tag.hot {
      border-color: var(--gold);
      color: var(--gold);
      background: var(--gold-dim);
    }

    /* â”€â”€ Filter bar â”€â”€ */
    .filter-bar {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 28px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    .filter-btn {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 5px 12px;
      border: 1px solid var(--border-mid);
      border-radius: 2px;
      background: none;
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-btn:hover {
      border-color: var(--text-dim);
      color: var(--text-mid);
    }

    .filter-btn.active {
      background: var(--gold-dim);
      border-color: var(--gold);
      color: var(--gold);
    }

    /* â”€â”€ Search â”€â”€ */
    .search-wrap {
      margin-bottom: 20px;
    }

    .search-input {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border-mid);
      border-radius: 2px;
      color: var(--text-mid);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      padding: 10px 16px;
      outline: none;
      transition: border-color 0.2s;
    }

    .search-input::placeholder {
      color: var(--text-faint);
    }

    .search-input:focus {
      border-color: var(--gold);
    }

    /* â”€â”€ Cards â”€â”€ */
    .feed {
      display: flex;
      flex-direction: column;
    }

    .card {
      border-bottom: 1px solid var(--border);
      padding: 32px 0;
      animation: fadeIn 0.35s ease-out both;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .card-meta {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .card-year {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      background: var(--surface);
      border: 1px solid var(--border-mid);
      color: var(--text-dim);
      padding: 2px 9px;
      border-radius: 2px;
      letter-spacing: 1px;
    }

    .card-category {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #5a5045;
    }

    .card-source {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      color: var(--text-faint);
      margin-left: auto;
      letter-spacing: 1px;
    }

    .card-prediction {
      font-family: 'Playfair Display', serif;
      font-size: clamp(17px, 3.5vw, 23px);
      font-weight: 700;
      line-height: 1.3;
      color: var(--text-mid);
      margin-bottom: 18px;
      font-style: italic;
      padding-left: 18px;
      position: relative;
    }

    .card-prediction::before {
      content: '';
      position: absolute;
      left: 0;
      top: 5px;
      bottom: 5px;
      width: 3px;
      background: var(--border-mid);
      border-radius: 2px;
    }

    .card-divider {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--text-faint);
    }

    .card-divider::before, .card-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    .card-reality {
      font-size: 14px;
      line-height: 1.7;
      color: var(--green);
      padding: 14px 18px;
      background: var(--green-bg);
      border-left: 3px solid var(--green-border);
      border-radius: 0 4px 4px 0;
      margin-bottom: 18px;
    }

    .card-actions {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .upvote-btn {
      display: flex;
      align-items: center;
      gap: 7px;
      background: none;
      border: 1px solid var(--border-mid);
      color: var(--text-faint);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      padding: 6px 14px;
      border-radius: 2px;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .upvote-btn:hover:not(.voted) {
      border-color: var(--gold);
      color: var(--gold);
    }

    .upvote-btn.voted {
      background: var(--gold-dim);
      border-color: var(--gold);
      color: var(--gold);
      cursor: default;
    }

    .share-btn {
      background: none;
      border: 1px solid var(--border);
      color: var(--text-faint);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      padding: 6px 12px;
      border-radius: 2px;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .share-btn:hover {
      border-color: var(--text-dim);
      color: var(--text-dim);
    }

    .doom-averted {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #3a5a22;
      margin-left: auto;
    }

    /* â”€â”€ Empty / no results â”€â”€ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-faint);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 2px;
    }

    .empty-state p:first-child {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      font-style: italic;
      color: var(--text-dim);
      margin-bottom: 12px;
    }

    /* â”€â”€ Load more â”€â”€ */
    .load-more {
      text-align: center;
      padding: 48px 0 20px;
    }

    .load-btn {
      background: none;
      border: 1px solid var(--border-mid);
      color: var(--text-dim);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      padding: 14px 36px;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 2px;
    }

    .load-btn:hover:not([disabled]) {
      border-color: var(--gold);
      color: var(--gold);
      box-shadow: 0 0 30px rgba(201, 168, 76, 0.08);
    }

    /* â”€â”€ Toast â”€â”€ */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: var(--surface);
      border: 1px solid var(--gold);
      color: var(--gold);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 2px;
      padding: 10px 24px;
      border-radius: 2px;
      transition: transform 0.3s ease;
      pointer-events: none;
      white-space: nowrap;
      z-index: 100;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
    }

    /* â”€â”€ Footer â”€â”€ */
    .footer {
      text-align: center;
      padding: 48px 0 20px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 2px;
      color: var(--text-faint);
      border-top: 1px solid var(--border);
      margin-top: 40px;
    }

    .footer a {
      color: var(--text-dim);
      text-decoration: none;
    }

    .footer a:hover { color: var(--gold); }
  </style>
</head>
<body>

<div class="app">

  <!-- Masthead -->
  <header class="masthead">
    <div class="masthead-eyebrow">The Retrospective Archive</div>
    <h1 class="masthead-title">The <em>Doom</em><br>That Wasn't</h1>
    <div class="masthead-rule"></div>
    <p class="masthead-sub">A curated record of catastrophes that failed to materialize</p>
  </header>

  <!-- Date / count line -->
  <div class="dateline">
    <span id="today-date"></span>
    <span class="dateline-count" id="entry-count"></span>
  </div>

  <!-- Algo / interest bar -->
  <div class="algo-section" id="algo-section" style="display:none">
    <div class="algo-label">your interests (upvote to tune)</div>
    <div class="algo-tags" id="algo-tags"></div>
  </div>

  <!-- Search -->
  <div class="search-wrap">
    <input class="search-input" type="search" id="search-input"
           placeholder="search predictions, sources, yearsâ€¦" autocomplete="off">
  </div>

  <!-- Category filters -->
  <div class="filter-bar" id="filter-bar"></div>

  <!-- Feed -->
  <div class="feed" id="feed"></div>

  <!-- Load more -->
  <div class="load-more" id="load-more" style="display:none">
    <button class="load-btn" id="load-btn">load more unfulfilled prophecies</button>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <p>The Doom That Wasn't Â· Open source Â· <a href="https://github.com/Innomen/DoomScroll">Contribute on GitHub</a></p>
    <p style="margin-top:8px">To add entries, edit <code>data/doom.json</code> and submit a pull request.</p>
  </footer>

</div>

<!-- Toast notification -->
<div class="toast" id="toast"></div>

<script>
// â”€â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PAGE_SIZE = 8;

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let allEntries   = [];  // raw from JSON
let displayList  = [];  // filtered + sorted
let pageIndex    = 0;
let votes        = {};  // id â†’ true
let weights      = {};  // category â†’ count
let activeFilter = 'ALL';
let searchQuery  = '';

// â”€â”€â”€ Persist to localStorage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveState() {
  try {
    localStorage.setItem('tdtw_votes',   JSON.stringify(votes));
    localStorage.setItem('tdtw_weights', JSON.stringify(weights));
  } catch(e) {}
}

function loadState() {
  try {
    votes   = JSON.parse(localStorage.getItem('tdtw_votes')   || '{}');
    weights = JSON.parse(localStorage.getItem('tdtw_weights') || '{}');
  } catch(e) {}
}

// â”€â”€â”€ Data loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadData() {
  const res = await fetch('data/doom.json');
  const json = await res.json();
  allEntries = json.entries;
  return json.meta;
}

// â”€â”€â”€ Scoring for algo feed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function score(entry) {
  return (weights[entry.category] || 0);
}

// â”€â”€â”€ Build display list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildDisplayList() {
  let list = [...allEntries];

  // Filter by category
  if (activeFilter !== 'ALL') {
    list = list.filter(e => e.category === activeFilter);
  }

  // Filter by search
  if (searchQuery) {
    const q = searchQuery.toLowerCase();
    list = list.filter(e =>
      e.prediction.toLowerCase().includes(q) ||
      e.source.toLowerCase().includes(q) ||
      e.reality.toLowerCase().includes(q) ||
      e.category.toLowerCase().includes(q) ||
      String(e.year).includes(q) ||
      (e.tags || []).some(t => t.includes(q))
    );
  }

  // Sort: voted items to bottom, then by algo weight desc, then shuffle rest
  list.sort(() => Math.random() - 0.5);
  list.sort((a, b) => {
    const aVoted = votes[a.id] ? 1 : 0;
    const bVoted = votes[b.id] ? 1 : 0;
    if (aVoted !== bVoted) return aVoted - bVoted;
    const scoreDiff = score(b) - score(a);
    if (scoreDiff !== 0) return scoreDiff;
    return 0;
  });

  displayList = list;
  pageIndex = 0;
}

// â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CATEGORY_EMOJI = {
  'Economic Collapse':     'ğŸ“‰',
  'Tech Apocalypse':       'ğŸ¤–',
  'Environmental Doom':    'ğŸŒ',
  'Political Catastrophe': 'ğŸ›ï¸',
  'Health Crisis':         'ğŸ¦ ',
  'Social Breakdown':      'ğŸ‘¥',
  'Food & Resource Scarcity': 'ğŸŒ¾',
  'War & Conflict':        'âš”ï¸',
};

function renderCard(entry, delay = 0) {
  const voted = !!votes[entry.id];
  const emoji = CATEGORY_EMOJI[entry.category] || 'ğŸ“°';

  const card = document.createElement('div');
  card.className = 'card';
  card.style.animationDelay = delay + 'ms';
  card.dataset.id = entry.id;

  card.innerHTML = `
    <div class="card-meta">
      <span class="card-year">${entry.year}</span>
      <span class="card-category">${emoji} ${entry.category}</span>
      <span class="card-source">via ${entry.source}</span>
    </div>
    <div class="card-prediction">&ldquo;${entry.prediction}&rdquo;</div>
    <div class="card-divider">what actually happened</div>
    <div class="card-reality">${entry.reality}</div>
    <div class="card-actions">
      <button class="upvote-btn ${voted ? 'voted' : ''}" data-id="${entry.id}" data-cat="${entry.category}">
        ${voted ? 'âœ¦ reassuring' : 'âœ§ reassuring'}
      </button>
      <button class="share-btn" data-id="${entry.id}">share</button>
      <span class="doom-averted">â— doom averted</span>
    </div>
  `;

  // Upvote
  card.querySelector('.upvote-btn').addEventListener('click', function() {
    if (votes[entry.id]) return;
    votes[entry.id] = true;
    weights[entry.category] = (weights[entry.category] || 0) + 1;
    saveState();
    this.classList.add('voted');
    this.textContent = 'âœ¦ reassuring';
    updateAlgoBar();
    showToast('Noted. Tuning your feed.');
  });

  // Share
  card.querySelector('.share-btn').addEventListener('click', function() {
    const text = `"${entry.prediction}" (${entry.year}, ${entry.source}) â€” it never happened. The Doom That Wasn't`;
    if (navigator.share) {
      navigator.share({ title: 'The Doom That Wasn\'t', text });
    } else {
      navigator.clipboard.writeText(text).then(() => showToast('Copied to clipboard.'));
    }
  });

  return card;
}

function renderPage() {
  const feed = document.getElementById('feed');
  const start = pageIndex * PAGE_SIZE;
  const slice = displayList.slice(start, start + PAGE_SIZE);

  if (pageIndex === 0) {
    feed.innerHTML = '';
    if (slice.length === 0) {
      feed.innerHTML = '<div class="empty-state"><p>Nothing found.</p><span>try adjusting your search or filter</span></div>';
      document.getElementById('load-more').style.display = 'none';
      return;
    }
  }

  slice.forEach((entry, i) => {
    feed.appendChild(renderCard(entry, i * 40));
  });

  pageIndex++;

  const hasMore = pageIndex * PAGE_SIZE < displayList.length;
  document.getElementById('load-more').style.display = hasMore ? 'block' : 'none';
}

// â”€â”€â”€ Algo bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateAlgoBar() {
  const section = document.getElementById('algo-section');
  const container = document.getElementById('algo-tags');
  const hasVotes = Object.values(weights).some(v => v > 0);

  if (!hasVotes) {
    section.style.display = 'none';
    return;
  }

  section.style.display = 'block';
  container.innerHTML = '';

  const allCats = Object.keys(CATEGORY_EMOJI);
  const sorted  = [...allCats].sort((a, b) => (weights[b] || 0) - (weights[a] || 0));
  const topScore = weights[sorted[0]] || 0;

  sorted.forEach(cat => {
    const w = weights[cat] || 0;
    const tag = document.createElement('span');
    tag.className = 'algo-tag' + (w > 0 && w === topScore ? ' hot' : (w > 0 ? ' hot' : ''));
    tag.className = 'algo-tag' + (w > 0 ? ' hot' : '');
    tag.textContent = `${CATEGORY_EMOJI[cat]} ${cat}${w > 0 ? ' Ã—' + w : ''}`;
    container.appendChild(tag);
  });
}

// â”€â”€â”€ Filter bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildFilterBar(meta) {
  const bar = document.getElementById('filter-bar');
  const all = document.createElement('button');
  all.className = 'filter-btn active';
  all.textContent = 'All';
  all.dataset.cat = 'ALL';
  bar.appendChild(all);

  meta.categories.forEach(cat => {
    const btn = document.createElement('button');
    btn.className = 'filter-btn';
    btn.textContent = (CATEGORY_EMOJI[cat] || '') + ' ' + cat;
    btn.dataset.cat = cat;
    bar.appendChild(btn);
  });

  bar.addEventListener('click', e => {
    const btn = e.target.closest('.filter-btn');
    if (!btn) return;
    bar.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    activeFilter = btn.dataset.cat;
    buildDisplayList();
    renderPage();
  });
}

// â”€â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2200);
}

// â”€â”€â”€ Date line â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setDateline(count) {
  document.getElementById('today-date').textContent =
    new Date().toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
  document.getElementById('entry-count').textContent = count + ' entries in the archive';
}

// â”€â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let searchTimer;
document.getElementById('search-input').addEventListener('input', function() {
  clearTimeout(searchTimer);
  searchTimer = setTimeout(() => {
    searchQuery = this.value.trim();
    buildDisplayList();
    renderPage();
  }, 220);
});

// â”€â”€â”€ Load more â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('load-btn').addEventListener('click', () => {
  renderPage();
});

// â”€â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(async function init() {
  loadState();

  let meta;
  try {
    meta = await loadData();
  } catch(e) {
    document.getElementById('feed').innerHTML =
      '<div class="empty-state"><p>Archive unavailable.</p><span>make sure data/doom.json is present</span></div>';
    return;
  }

  setDateline(allEntries.length);
  buildFilterBar(meta);
  updateAlgoBar();
  buildDisplayList();
  renderPage();
})();
</script>
</body>
</html>
